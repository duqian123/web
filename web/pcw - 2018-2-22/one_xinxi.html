<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="format-detection" content="telephone=no">
        <title>拼车网</title>
        <script type="text/javascript" src="http://tajs.qq.com/stats?sId=37342703" charset="UTF-8"></script>
        <link rel="stylesheet" href="css/frozen/weui-demo.css">
        <link rel="stylesheet" href="css/frozen/weui.min.css">

     <!--   <link rel="stylesheet" type="text/css" href="css/frozen/ycbootstrap.css"/>
        <link rel="stylesheet" type="text/css" href="css/frozen/reset.css"/>
-->
        <link rel="stylesheet" href="css/frozen/frozen.css">
        <link rel="stylesheet" href="css/frozen/forzen-demo.css">

        <link rel="stylesheet" href="css/frozen/index.css">
        <link rel="stylesheet" href="css/frozen/edit.css">
        <link rel="stylesheet" href="css/frozen/one_xinxi.css">

        <script src="lib/zepto.min.js"></script>
        <script src="js/frozen.js"></script>
    </head>
    
    <body ontouchstart>
        <header class="ui-header ui-header-stable ui-border-b">
            <i class="ui-icon-return" onclick="back()"><span class="back">返回</span></i><h1>编辑资料</h1>
        </header>

<section class="ui-container">
       <section id="list">
           <div class="demo-item user_img_sex">
               <div class="demo-block">
                   <ul class="ui-list ui-list-pure ">
                       <div style="min-height:1px;line-height:160px;text-align:center;position:relative;" ontouchstart="">
                           <div class="cover-wrap" style="display:none;position:fixed;left:0;top:0;width:100%;height:100%;background: rgba(0, 0, 0, 0.4);z-index: 10000000;text-align:center;">
                               <div class="" style="width:100%;height:333px;margin:100px auto;background-color:#FFFFFF;overflow: hidden;border-radius:4px;">
                                   <div id="clipArea" style="margin:10px;height: 250px;"></div>
                                   <div class="" id="bc" style="height:56px;line-height:36px;text-align: center;padding-top:8px;">
                                       <button id="clipBtn" style="width:120px;height: 36px;border-radius: 4px;background-color:#ff8a00;color: #FFFFFF;font-size: 14px;text-align: center;line-height: 36px;outline: none;">保存</button>
                                       <button id="fh" style="width:120px;height: 36px;border-radius: 4px;background-color:#ff8a00;color: #FFFFFF;font-size: 14px;text-align: center;line-height: 36px;outline: none;">返回</button>
                                   </div>
                               </div>
                           </div>


                       </div>
                       <li class=" user_cont">
                           <div class="user_photo" id="view" style="background-color:#ffffff !important;"><div class="camera"></div></div>

                           <div class="sex_box">
                               <button id="nan" class="nan nan_style"><i class="ui-icon i_style">&#xf639;</i><span class="i_style sex">男</span></button>
                               <button id="nv" class="nv"><i class="ui-icon">&#xf63a;</i><span class="">女</span></button>
                           </div>
                       </li>
                   </ul>
               </div>
           </div>
           <div class="zw"></div>
           <div class="ui-poptips ui-poptips-warn">
               <div class="ui-poptips-cnt"><i></i>手机号无法修改</div>
           </div>
           <div class="demo-item">
               <div class="demo-block">
                   <div class="pj_content">
                       <div class="ui-form-item ">
                           <ul class="ui-list-pure">
                               <li class="ui-border-b content">
                                   <div class="caozuo">
                                       <label for="user_nc">昵称</label>
                                       <input type="text" value="" placeholder="请输入昵称" id="user_nc" class="input_txt">
                                   </div>
                               </li>
                               <li class="ui-border-b content">
                                   <div class="caozuo">
                                       <label for="name">姓名</label>
                                       <input type="text" value="" placeholder="请输入姓名" id="name" class="input_txt">
                                   </div>
                               </li>

                               <li class="ui-border-b content">
                                   <div class="caozuo">
                                       <label for="picker_name">出生日期</label>
                                       <div class="weui-cell__bd">
                                           <input class="weui-input input_txt" id="picker_name" type="text" placeholder="请选择" value="" readonly="">
                                       </div>
                                   </div>
                               </li>
                               <li class=" content">
                                   <div class="ui-btn-wrap">
                                       <button class="ui-btn-lg disabled ui-btn-danger">
                                           确定
                                       </button>
                                   </div>
                               </li>
                           </ul>
                       </div>

                   </div>
               </div>
           </div>
       </section>
</section>
        <footer class="footer ui-footer">
            <div class="clipbg">
                <dl>
                    <dd style="background: #f12f2f; color: #ffffff;border: none;">打开<input type="file" id="file" accept="image/jpeg, image/x-png, image/gif"></dd>
                </dl>
                <div class="qx">取消</div>
            </div>
        </footer>
        <script src="js/jquery.min.js"></script>
        <script src="js/url.js"></script>
        <script src="js/weixin.js"></script>

        <script src="js/cover_js/iscroll-zoom.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/cover_js/hammer.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/cover_js/lrz.all.bundle.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/cover_js/jquery.photoClip.min.js" type="text/javascript" charset="utf-8"></script>

<script>
    (function ($) {
        $.getUrlParam = function (name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return null;
        }
    })(jQuery);
    var phone = $.getUrlParam("ph");
    var yzm = $.getUrlParam("yzm");
    var sid = $.getUrlParam("sid");
    console.log(phone+"---"+yzm+"---"+sid);
    $(function(){

        /*性别按钮切换*/
        $("#nan").on("tap",function(){
            $(this).addClass("nan_style");
            $(this).find("span").addClass("i_style");
            $(this).find("span").addClass("sex");
            $(this).find("i").addClass("i_style");
            $("#nv").removeClass("nv_style");
            $("#nv").find("span").removeClass("i_style");
            $("#nv").find("span").removeClass("sex");
            $("#nv").find("i").removeClass("i_style");
        });
        $("#nv").on("tap",function(){
            $(this).addClass("nv_style");
            $(this).find("span").addClass("i_style");
            $(this).find("span").addClass("sex");
            $(this).find("i").addClass("i_style");
            $("#nan").removeClass("nan_style");
            $("#nan").find("span").removeClass("i_style");
            $("#nan").find("span").removeClass("sex");
            $("#nan").find("i").removeClass("i_style");
        });



        /*信息编辑*/
        $(".caozuo input").focus(function(){
            $(this).attr("class","input_new");
        })
        $(".caozuo input").blur(function(){
            $(this).attr("class","input_txt");
        })



        /*选择出生日期*/
        $('#picker_name').on('click', function () {
            weui.datePicker({
                start: 1940,
                end: new Date().getFullYear(),
                onChange: function (result) {
                    //console.log("onChange"+result);
                },
                onConfirm: function (result) {
                    //console.log("onConfirm"+result);
                    $("#picker_name").val(result);


                    var picker_name = $("#picker_name").val();
                    var reg = /,/g;
                    var rq = picker_name.replace(reg, '-');

                    tx_img = tx_img.replace("data:image/jpeg;base64,", '');

                        if($("#user_nc").val()!=""&&$("#name").val()!=""&&picker_name!=""){
                                $(".ui-btn-wrap button").removeClass("disabled");
                                $('.ui-btn-wrap .ui-btn-lg').click(function() {
                                    var sex = $(".sex_box button .sex").html();
                                    var user_nc = $("#user_nc").val();
                                    var name = $("#name").val();
                                    $.ajax({
                                        url:register,
                                        type:"post",
                                        data:{
                                            tx_img:tx_img,
                                            sex:sex,
                                            nick_name:user_nc,
                                            u_name:name,
                                            rq:rq,
                                            phone:phone,
                                            yzm:yzm,
                                            session_id:sid
                                        },
                                        success:function(res){
                                            console.log(res);
                                            if(res.code==2000){
                                                window.localStorage.setItem("token",res.data);
                                                location.href = my+".html?ph="+phone;
                                            }
                                        }
                                    });
                                    console.log(tx_img+"+++"+sex+"-"+user_nc + "-" + name + "-" + rq+"-"+phone+"-"+yzm+"-"+sid);
                                });
                            $("#user_nc,#name").bind("input propertychange", function() {
                                if($(this).val()!=""&&$("#user_nc").val()!=""&&$("#name").val()!=""){
                                    $(".ui-btn-wrap button").removeClass("disabled");
                                }else{
                                    $(".ui-btn-wrap button").addClass("disabled");
                                }
                            });
                        }else{
                            $(".ui-btn-wrap button").addClass("disabled");
                        }

                }
            });
        });
        var tx_img;
        /*选择头像*/
        var clipArea = new bjj.PhotoClip("#clipArea", {
            size: [100, 100],// 截取框的宽和高组成的数组。默认值为[260,260]
            outputSize: [100, 100], // 输出图像的宽和高组成的数组。默认值为[0,0]，表示输出图像原始大小
            //outputType: "jpg", // 指定输出图片的类型，可选 "jpg" 和 "png" 两种种类型，默认为 "jpg"
            file: "#file", // 上传图片的<input type="file">控件的选择器或者DOM对象
            view: "#view", // 显示截取后图像的容器的选择器或者DOM对象
            ok: "#clipBtn", // 确认截图按钮的选择器或者DOM对象
            loadStart: function() {
                // 开始加载的回调函数。this指向 fileReader 对象，并将正在加载的 file 对象作为参数传入
                $('.cover-wrap').fadeIn();
                console.log("照片读取中");
            },
            loadComplete: function() {
                // 加载完成的回调函数。this指向图片对象，并将图片地址作为参数传入
                console.log("照片读取完成");
            },
            //loadError: function(event) {}, // 加载失败的回调函数。this指向 fileReader 对象，并将错误事件的 event 对象作为参数传入
            clipFinish: function(dataURL) {
                // 裁剪完成的回调函数。this指向图片对象，会将裁剪出的图像数据DataURL作为参数传入
                $('.cover-wrap').fadeOut();
                $('#view').css('background-size','100% 100%');
                tx_img = dataURL;
                //console.log(tx_img);
            }
        });
        //console.log(clipArea);
        $("#view").removeAttr("style");

        $(".qx").click(function(){
            $(".footer").css("display","none");
        })
        $("#view").click(function(){
            $(".footer").css("display","block");
        });
        $("#bc #clipBtn").click(function(){
            $(".footer").css("display","none");
        });
        $("#bc #fh").click(function(){
            $(".cover-wrap").css("display","none");
        });

        $(".ui-footer").click(function(){
            $(this).css("display","none");
        })
    });

    /*返回*/
    function back(){
        if(history.length==0){
            location.href = my+'.html';
        }else if(history.length>=1){
            history.go(-1);
        }
    }
 </script>

</body>
</html>
