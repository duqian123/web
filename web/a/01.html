<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>拼车网</title>
    <script type="text/javascript" src="http://tajs.qq.com/stats?sId=37342703" charset="UTF-8"></script>
    <link rel="stylesheet" href="../pcw/css/frozen/frozen.css">
    <link rel="stylesheet" href="../pcw/css/frozen/forzen-demo.css">
    <link rel="stylesheet" href="../pcw/css/frozen/index.css">
    <link rel="stylesheet" href="../pcw/css/frozen/choose_car.css">
    <script src="../pcw/lib/zepto.min.js"></script>
    <script src="../pcw/js/frozen.js"></script>
</head>

<body ontouchstart>
<header class="ui-header ui-header-positive ui-border-b">
    <div class="choose_car_nav">
        <ul class="ui-row-flex">
            <li class="ui-col ui-col"><a href="javascript:void(0);">默认排序<span></span></a><span class="line"></span></li>

            <li class="ui-col ui-col"><a href="javascript:void(0);">品牌<span></span></a><span class="line"></span></li>

            <li class="ui-col ui-col"><a href="javascript:void(0);">价格区间<span></span></a><span class="line"></span></li>

            <li class="ui-col ui-col"><a href="javascript:void(0);">搜索<span></span></a></li>
        </ul>
    </div>
</header>
<footer class="ui-footer ui-footer-btn">
    <ul class="ui-tiled ui-border-t">
        <li data-href="index.html" class="footer_li">
            <div></div>
            <div>首页</div>
        </li>
        <li data-href="choose_car.html" class="footer_li">
            <div></div>
            <div>选车</div>
        </li>
        <li data-href="canon.html" class="footer_li">
            <div></div>
            <div>宝典</div>
        </li>
        <li data-href="my.html" class="footer_li">
            <div></div>
            <div>我的</div>
        </li>
    </ul>
</footer>
<section class="ui-container">
    <section id="list">
        <div class="demo-item">
            <div class="demo-block">
                <ul class="ui-list-pure ui-border-b choose_car_content">
                    <li class="item">
                        <a href="../pcw/details.html">
                            <div class="choose_car_img"></div>
                            <div class="choose_car_txt">
                                <p>福特福睿斯 2017款 1.5L 自动舒适型</p>
                                <p>厂商指导价：10.34万</p>
                                <div><span class="tgj">团购价 <span>50.28</span> 万</span><span>立省 8.24万</span></div>
                            </div>
                        </a>
                    </li>
                    <li class="ui-border-t item">
                        <a href="../pcw/details.html">
                            <div class="choose_car_img"></div>
                            <div class="choose_car_txt">
                                <p>福特福睿斯 2017款 1.5L 自动舒适型</p>
                                <p>厂商指导价：10.34万</p>
                                <div><span class="tgj">团购价 <span>50.28</span> 万</span><span>立省 8.24万</span></div>
                            </div>
                        </a>
                    </li>
                    <li class="ui-border-t item">
                        <a href="../pcw/details.html">
                            <div class="choose_car_img"></div>
                            <div class="choose_car_txt">
                                <p>福特福睿斯 2017款 1.5L 自动舒适型</p>
                                <p>厂商指导价：10.34万</p>
                                <div><span class="tgj">团购价 <span>50.28</span> 万</span><span>立省 8.24万</span></div>
                            </div>
                        </a>
                    </li>
                    <li class="ui-border-t item">
                        <a href="../pcw/details.html">
                            <div class="choose_car_img"></div>
                            <div class="choose_car_txt">
                                <p>福特福睿斯 2017款 1.5L 自动舒适型</p>
                                <p>厂商指导价：10.34万</p>
                                <div><span class="tgj">团购价 <span>50.28</span> 万</span><span>立省 8.24万</span></div>
                            </div>
                        </a>
                    </li>
                    <li class="ui-border-t item">
                        <a href="../pcw/details.html">
                            <div class="choose_car_img"></div>
                            <div class="choose_car_txt">
                                <p>福特福睿斯 2017款 1.5L 自动舒适型</p>
                                <p>厂商指导价：10.34万</p>
                                <div><span class="tgj">团购价 <span>50.28</span> 万</span><span>立省 8.24万</span></div>
                            </div>
                        </a>
                    </li>
                    <li class="ui-border-t item">
                        <a href="../pcw/details.html">
                            <div class="choose_car_img"></div>
                            <div class="choose_car_txt">
                                <p>福特福睿斯 2017款 1.5L 自动舒适型</p>
                                <p>厂商指导价：10.34万</p>
                                <div><span class="tgj">团购价 <span>50.28</span> 万</span><span>立省 8.24万</span></div>
                            </div>
                        </a>
                    </li>
                    <li class="ui-border-t item">
                        <a href="../pcw/details.html">
                            <div class="choose_car_img"></div>
                            <div class="choose_car_txt">
                                <p>福特福睿斯 2017款 1.5L 自动舒适型</p>
                                <p>厂商指导价：10.34万</p>
                                <div><span class="tgj">团购价 <span>50.28</span> 万</span><span>立省 8.24万</span></div>
                            </div>
                        </a>
                    </li>
                    <li class="ui-border-t item">
                        <a href="../pcw/details.html">
                            <div class="choose_car_img"></div>
                            <div class="choose_car_txt">
                                <p>福特福睿斯 2017款 1.5L 自动舒适型</p>
                                <p>厂商指导价：10.34万</p>
                                <div><span class="tgj">团购价 <span>50.28</span> 万</span><span>立省 8.24万</span></div>
                            </div>
                        </a>
                    </li>
                    <li class="ui-border-t item">
                        <a href="../pcw/details.html">
                            <div class="choose_car_img"></div>
                            <div class="choose_car_txt">
                                <p>福特福睿斯 2017款 1.5L 自动舒适型</p>
                                <p>厂商指导价：10.34万</p>
                                <div><span class="tgj">团购价 <span>50.28</span> 万</span><span>立省 8.24万</span></div>
                            </div>
                        </a>
                    </li>
                    <li class="ui-border-t item">
                        <a href="../pcw/details.html">
                            <div class="choose_car_img"></div>
                            <div class="choose_car_txt">
                                <p>福特福睿斯 2017款 1.5L 自动舒适型</p>
                                <p>厂商指导价：10.34万</p>
                                <div><span class="tgj">团购价 <span>50.28</span> 万</span><span>立省 8.24万</span></div>
                            </div>
                        </a>
                    </li>
                    <li class="ui-border-t item">
                        <a href="../pcw/details.html">
                            <div class="choose_car_img"></div>
                            <div class="choose_car_txt">
                                <p>福特福睿斯 2017款 1.5L 自动舒适型</p>
                                <p>厂商指导价：10.34万</p>
                                <div><span class="tgj">团购价 <span>50.28</span> 万</span><span>立省 8.24万</span></div>
                            </div>
                        </a>
                    </li>
                    <li class="ui-border-t item">
                        <a href="../pcw/details.html">
                            <div class="choose_car_img"></div>
                            <div class="choose_car_txt">
                                <p>福特福睿斯 2017款 1.5L 自动舒适型</p>
                                <p>厂商指导价：10.34万</p>
                                <div><span class="tgj">团购价 <span>50.28</span> 万</span><span>立省 8.24万</span></div>
                            </div>
                        </a>
                    </li>
                </ul>
                <div id="page_tag_load" style=" display:none; font-size:14px;position:relative; bottom:0px; background-color:#ebeced;height:30px;line-height:40px;text-align: center;">加载中...</div>
            </div>
        </div>
    </section>
</section>

<script src="../pcw/js/jquery.min.js"></script>
<script>
    $('.ui-list li,.ui-tiled li').click(function () {
        if ($(this).data('href')) {
            location.href = $(this).data('href');
        }
    });


</script>
<script type="text/javascript" src="../pcw/js/jquery.min.js"></script>
<script type="text/javascript" src="../pcw/js/jquery.masonry.min.js"></script>
<!--这个插件只是为了扩展jquery的animate函数动态效果可有可无-->

<script type="text/javascript">
    /*
     抛开瀑布流布局各种乱七八糟的算法，基于masonry的瀑布流，很是简单的，而且通过扩展animate,能实现瀑布流布局的晃动、弹球等效果。
     masonry还有很多参数我这里注解了常用的参数
     */
    $(function(){
        /*瀑布流开始*/
        var container = $('.choose_car_content');
        var loading=$('#page_tag_load');
        // 初始化loading状态
        loading.data("on",true);

        container.imagesLoaded(function(){
            container.masonry({
                columnWidth: 320,
                itemSelector : '.item',
                isFitWidth: true,//是否根据浏览器窗口大小自动适应默认false
                isAnimated: true,//是否采用jquery动画进行重拍版
                isRTL:false,//设置布局的排列方式，即：定位砖块时，是从左向右排列还是从右向左排列。默认值为false，即从左向右
                isResizable: true,//是否自动布局默认true
                animationOptions: {
                    duration: 1000,
                    easing: 'easeInOutBack',//如果你引用了jQeasing这里就可以添加对应的动态动画效果，如果没引用删除这行，默认是匀速变化
                    queue: false//是否队列，从一点填充瀑布流
                }
            });
        });
        /*模拟从后台获取到的数据*/
        //var sqlJson=[{'title':'瀑布流其实就是几个函数的事！','intro':'爆料，苏亚雷斯又咬人啦，C罗哪有内马尔帅，梅西今年要不夺冠，你就去泰国吧，老子买了阿根廷赢得彩票，输了就去不成了。','src':'images/one.jpg','writer':'jq22','date':'2小时前','looked':321},{'title':'瀑布流其实就是几个函数的事！','intro':'爆料了，苏亚雷斯又咬人啦，C罗哪有内马尔帅，梅西今年要不夺冠，你就去泰国吧，老子买了阿根廷赢得彩票，输了就去不成了。','src':'images/demo2.jpg','writer':'jq22','date':'2小时前','looked':321},{'title':'瀑布流其实就是几个函数的事！','intro':'爆料了，苏亚雷斯又咬人啦，C罗哪有内马尔帅，梅西今年要不夺冠，你就去泰国吧，老子买了阿根廷赢得彩票，输了就去不成了。','src':'images/p1.jpg','writer':'jq22','date':'2小时前','looked':321},{'title':'瀑布流其实就是几个函数的事！','intro':'爆料了，苏亚雷斯又咬人啦，C罗哪有内马尔帅，梅西今年要不夺冠，你就去泰国吧，老子买了阿根廷赢得彩票，输了就去不成了。','src':'images/p1.jpg','writer':'jq22','date':'2小时前','looked':321}];
        /*本应该通过ajax从后台请求过来类似sqljson的数据然后，便利，进行填充，这里我们用sqlJson来模拟一下数据*/
        $(window).scroll(function(){
            if(!loading.data("on")) return;
            // 计算所有瀑布流块中距离顶部最大，进而在滚动条滚动时，来进行ajax请求，方法很多这里只列举最简单一种，最易理解一种
            var itemNum=$('.choose_car_content').find('.item').length;
            var itemArr=[];
            itemArr[0]=$('.choose_car_content').find('.item').eq(itemNum-1).offset().top+$('.choose_car_content').find('.item').eq(itemNum-1)[0].offsetHeight;
            itemArr[1]=$('.choose_car_content').find('.item').eq(itemNum-2).offset().top+$('.choose_car_content').find('.item').eq(itemNum-1)[0].offsetHeight;
            itemArr[2]=$('.choose_car_content').find('.item').eq(itemNum-3).offset().top+$('.choose_car_content').find('.item').eq(itemNum-1)[0].offsetHeight;
            var maxTop=Math.max.apply(null,itemArr);
            console.log(maxTop+"---------");
            var sqlJson = "";
            $.getJSON("../js/choose_car.json",function (res) {;
                        sqlJson = res;
                    }
            );
            console.log($(window).height()+$(document).scrollTop()+"+++++++++++");
            if(maxTop<$(window).height()+$(document).scrollTop()){
                //加载更多数据
                loading.data("on",false).fadeIn(800);



                (function(res){
                    /*这里会根据后台返回的数据来判断是否你进行分页或者数据加载完毕这里假设大于30就不在加载数据*/
                    if(itemNum>30){
                        loading.text('就有这么多了！');
                    }else{
                        var html="";
                        for(var i in res){
                            var html = "<li class='ui-border-t item'>" +
                                    "<a href='../pcw/details.html'>" +
                                    "<div class='choose_car_img'></div>" +
                                    "<div class='choose_car_txt'>" +
                                    "<p>"+res[i].txt1+"</p>" +
                                    "<p>"+res[i].txt2+"</p>" +
                                    "<div>" +
                                    "<span class='tgj'>"+res[i].txt3+"<span>"+res[i].txt4+"</span>"+ res[i].txt5+"</span>" +
                                    "<span>"+res[i].txt6+"</span>" +
                                    "</div>" +
                                    "</div>" +
                                    "</a>" +
                                    "</li>";
                        }
                        /*模拟ajax请求数据时延时800毫秒*/
                        var time=setTimeout(function(){

                            $(".choose_car_content").append(html);
                            $newElems.imagesLoaded(function(){
                                $newElems.animate({ opacity: 1},800);
                                container.masonry( 'appended', $newElems,true);
                                loading.data("on",true).fadeOut();
                                clearTimeout(time);
                            });
                        },800)
                    }
                })(sqlJson);
            }
        });

    })
</script>
</body>
</html>